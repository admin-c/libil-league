<!DOCTYPE html>
<html>
<head>
    <title>–û—Ç–ª–∞–¥–∫–∞ —Å–∏—Å—Ç–µ–º—ã</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #0f172a; color: white; }
        .section { background: #1e293b; padding: 20px; margin: 20px 0; border-radius: 10px; }
        button { padding: 10px 20px; margin: 5px; background: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        pre { background: #0a0f1c; padding: 15px; border-radius: 5px; overflow: auto; }
    </style>
</head>
<body>
    <h1>üîß –û—Ç–ª–∞–¥–∫–∞ —Å–∏—Å—Ç–µ–º—ã –õ–™–∏–±–∏–ª—Å–∫–∞—è –õ–∏–≥–∞</h1>
    
    <div class="section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ API</h2>
        <button onclick="checkAPI()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å /api/data</button>
        <button onclick="checkHealth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å /api/health</button>
        <div id="apiResult"></div>
    </div>
    
    <div class="section">
        <h2>2. –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h2>
        <input type="text" id="testTeam" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã" value="–¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞">
        <input type="text" id="testOwner" placeholder="–í–ª–∞–¥–µ–ª–µ—Ü" value="–¢–µ—Å—Ç–æ–≤—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü">
        <button onclick="testRegistration()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞—è–≤–∫—É</button>
        <div id="regResult"></div>
    </div>
    
    <div class="section">
        <h2>3. –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ</h2>
        <button onclick="loadData()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
        <div id="dataResult"></div>
    </div>
    
    <div class="section">
        <h2>4. –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞</h2>
        <button onclick="clearCache()">–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞</button>
        <button onclick="clearAll()">–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å</button>
    </div>
    
    <script>
        async function checkAPI() {
            try {
                const res = await fetch('/api/data');
                const data = await res.json();
                document.getElementById('apiResult').innerHTML = `
                    <p class="success">‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç</p>
                    <p>–ö–æ–º–∞–Ω–¥ –≤ —Ç–∞–±–ª–∏—Ü–µ: ${data.standings?.length || 0}</p>
                    <p>–û–∂–∏–¥–∞—é—â–∏—Ö –∑–∞—è–≤–æ–∫: ${data.pendingRegistrations?.length || 0}</p>
                    <button onclick="showData()">–ü–æ–∫–∞–∑–∞—Ç—å JSON</button>
                    <pre id="jsonData" style="display:none">${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (err) {
                document.getElementById('apiResult').innerHTML = `<p class="error">‚ùå –û—à–∏–±–∫–∞: ${err.message}</p>`;
            }
        }
        
        function showData() {
            const el = document.getElementById('jsonData');
            el.style.display = el.style.display === 'none' ? 'block' : 'none';
        }
        
        async function checkHealth() {
            try {
                const res = await fetch('/api/health');
                const data = await res.json();
                document.getElementById('apiResult').innerHTML = `
                    <p class="success">‚úÖ Health check</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (err) {
                document.getElementById('apiResult').innerHTML = `<p class="error">‚ùå –û—à–∏–±–∫–∞: ${err.message}</p>`;
            }
        }
        
        async function testRegistration() {
            const team = document.getElementById('testTeam').value;
            const owner = document.getElementById('testOwner').value;
            
            const registration = {
                team: team,
                owner: owner,
                email: 'test@example.com',
                phone: '+79999999999',
                date: new Date().toISOString()
            };
            
            try {
                const res = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(registration)
                });
                
                const data = await res.json();
                if (res.ok) {
                    document.getElementById('regResult').innerHTML = `
                        <p class="success">‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</p>
                        <p>ID: ${data.registrationId}</p>
                        <p>–ö–æ–º–∞–Ω–¥–∞: ${data.team}</p>
                        <p>–°–æ–æ–±—â–µ–Ω–∏–µ: ${data.message}</p>
                    `;
                } else {
                    document.getElementById('regResult').innerHTML = `
                        <p class="error">‚ùå –û—à–∏–±–∫–∞: ${data.error}</p>
                    `;
                }
            } catch (err) {
                document.getElementById('regResult').innerHTML = `<p class="error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${err.message}</p>`;
            }
        }
        
        async function loadData() {
            const data = await (await fetch('/api/data')).json();
            document.getElementById('dataResult').innerHTML = `
                <h3>–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:</h3>
                <p><strong>–ö–æ–º–∞–Ω–¥—ã –≤ —Ç–∞–±–ª–∏—Ü–µ:</strong> ${data.standings?.length || 0}</p>
                <ul>
                    ${(data.standings || []).map(t => `<li>${t.team} (${t.owner}) - ${t.points} –æ—á–∫–æ–≤</li>`).join('')}
                </ul>
                <p><strong>–û–∂–∏–¥–∞—é—â–∏–µ –∑–∞—è–≤–∫–∏:</strong> ${data.pendingRegistrations?.length || 0}</p>
                <ul>
                    ${(data.pendingRegistrations || []).map(r => `<li>${r.team} (${r.owner}) - ${new Date(r.date).toLocaleString()}</li>`).join('')}
                </ul>
            `;
        }
        
        function clearCache() {
            localStorage.clear();
            sessionStorage.clear();
            caches.keys().then(names => names.forEach(name => caches.delete(name)));
            alert('–ö—ç—à –æ—á–∏—â–µ–Ω!');
        }
        
        function clearAll() {
            if (confirm('–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å?')) {
                clearCache();
                indexedDB.databases().then(dbs => {
                    dbs.forEach(db => indexedDB.deleteDatabase(db.name));
                });
                location.reload();
            }
        }
    </script>
</body>
</html>
