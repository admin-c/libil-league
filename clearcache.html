<!DOCTYPE html>
<html>
<head>
    <title>–û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ - –õ–™–∏–±–∏–ª—Å–∫–∞—è –õ–∏–≥–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
            background: #0f172a;
            color: white;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: #1e293b;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        button {
            padding: 12px 24px;
            margin: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        .primary {
            background: #3b82f6;
            color: white;
        }
        .primary:hover {
            background: #2563eb;
        }
        .success {
            background: #10b981;
            color: white;
        }
        .error {
            background: #ef4444;
            color: white;
        }
        .info {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßπ –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h1>
        
        <div class="info">
            <p>–ï—Å–ª–∏ —Å–∞–π—Ç –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é,</p>
            <p>–æ—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à —Å –ø–æ–º–æ—â—å—é —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.</p>
        </div>
        
        <div id="status">
            <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—á–∏—Å—Ç–∫–∏:</p>
        </div>
        
        <div>
            <button class="primary" onclick="clearCache()">–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</button>
            <button onclick="goHome()">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
            <button onclick="hardReset()" class="error">–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å</button>
        </div>
        
        <div id="cacheInfo" style="margin-top: 30px; text-align: left;"></div>
    </div>
    
    <script>
        async function clearCache() {
            const status = document.getElementById('status');
            status.innerHTML = '<p>‚è≥ –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞...</p>';
            
            try {
                // 1. –û—á–∏—â–∞–µ–º —á–µ—Ä–µ–∑ Service Worker Manager
                if (window.swManager) {
                    await window.swManager.clearCache();
                }
                
                // 2. –û—á–∏—â–∞–µ–º –Ω–∞–ø—Ä—è–º—É—é
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    for (const name of cacheNames) {
                        await caches.delete(name);
                    }
                }
                
                // 3. –£–¥–∞–ª—è–µ–º Service Workers
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (const reg of registrations) {
                        await reg.unregister();
                    }
                }
                
                // 4. –û—á–∏—â–∞–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
                localStorage.clear();
                sessionStorage.clear();
                
                // 5. –û—á–∏—â–∞–µ–º IndexedDB
                if (window.indexedDB) {
                    const dbs = await indexedDB.databases();
                    for (const db of dbs) {
                        if (db.name) {
                            indexedDB.deleteDatabase(db.name);
                        }
                    }
                }
                
                status.innerHTML = `
                    <p class="success">‚úÖ –ö—ç—à —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω!</p>
                    <p>–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã...</p>
                `;
                
                setTimeout(() => {
                    window.location.href = 'index.html?nocache=' + Date.now();
                }, 3000);
                
            } catch (error) {
                status.innerHTML = `
                    <p class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>
                `;
            }
        }
        
        async function hardReset() {
            if (!confirm('–í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç –ø–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                return;
            }
            
            await clearCache();
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
            document.cookie.split(";").forEach(cookie => {
                document.cookie = cookie.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
            });
            
            alert('–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è.');
            window.location.href = 'index.html?hardreset=' + Date.now();
        }
        
        function goHome() {
            window.location.href = 'index.html';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫—ç—à–µ
        async function showCacheInfo() {
            const cacheInfo = document.getElementById('cacheInfo');
            
            try {
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    cacheInfo.innerHTML = `
                        <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫—ç—à–µ:</h3>
                        <p>–ö—ç—à–µ–π: ${cacheNames.length}</p>
                        <ul>
                            ${cacheNames.map(name => `<li>${name}</li>`).join('')}
                        </ul>
                    `;
                }
            } catch (error) {
                cacheInfo.innerHTML = `<p>–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é: ${error.message}</p>`;
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            showCacheInfo();
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º auto
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('auto')) {
                setTimeout(clearCache, 1000);
            }
        });
    </script>
</body>
</html>
